# ğŸ”¥ Assignment_MAPIA(with NestJS)

ğŸ¼ wanted x wecode í”„ë¦¬ì˜¨ë³´ë”© ë°±ì—”ë“œ ì½”ìŠ¤ - [Assignment 2] ë§ˆí”¼ì•„ì»´í¼ë‹ˆ

[ë§ˆí”¼ì•„ì»´í¼ë‹ˆ ì‚¬ì´íŠ¸](http://www.mapiacompany.com/)<br/>
[wanted ì±„ìš©ê³µê³  ì‚¬ì´íŠ¸](https://www.wanted.co.kr/company/6137)

<br/>

## â˜„ï¸ íŒ€ì› ì†Œê°œ

| ì´ë¦„                                     | ë‹´ë‹¹ ê¸°ëŠ¥                                 |
| ---------------------------------------- | ----------------------------------------- |
| [ê¹€ë°”ë‹¤](https://github.com/sally0226)   | REST API êµ¬í˜„, Graphql API êµ¬í˜„           |
| [ê¹€íš¨ë¯¼](https://github.com/luckyhyom)   | Neo4j ì„¤ì •, REST API êµ¬í˜„, e2e í…ŒìŠ¤íŠ¸êµ¬í˜„ |
| [ì›ë™ê· ](https://github.com/WonDongGyun) | Graphql ì„¤ì •, Graphql API êµ¬í˜„, Graphql unit í…ŒìŠ¤íŠ¸êµ¬í˜„|
| [ì´ë‚˜ì˜](https://github.com/bokiri409)   | REST API êµ¬í˜„, Graphql API êµ¬í˜„           |
| [ì¥í¬ì§„](https://github.com/heejin99)    | REST API êµ¬í˜„, Graphql API êµ¬í˜„           |
| [ì¡°ì¬ë³µ](https://github.com/ildang100)   | REST API êµ¬í˜„, e2e í…ŒìŠ¤íŠ¸êµ¬í˜„             |

<br/>

## ğŸŒ ë°°í¬

ì£¼ì†Œ : http://52.14.26.207:3000

<br/>



## ğŸ›  í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ì„œë²„ ì‹¤í–‰ ë°©ë²•

1. ìƒë‹¨ì˜ Code ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²½ë¡œë¥¼ ë³µì‚¬í•œ í›„ í´ë¡  ë°›ìŠµë‹ˆë‹¤.

```
$ git clone https://github.com/preOnboarding-Team13/Assignment_1_AIMMO_nest.git
```

2. íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
$ npm install
```

3. ì„œë²„ë¥¼ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤.

```
$ npm start
```

4. ì •í•´ì§„ APIì— ì ‘ê·¼í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

<br/>


## ğŸ“ ê³¼ì œ ìš”êµ¬ì‚¬í•­

### [í•„ìˆ˜ í¬í•¨ ì‚¬í•­]

-   READ.ME ì‘ì„±
    -   í”„ë¡œì íŠ¸ ë¹Œë“œ, ìì„¸í•œ ì‹¤í–‰ ë°©ë²• ëª…ì‹œ
    -   êµ¬í˜„ ë°©ë²•ê³¼ ì´ìœ ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…
    -   ì™„ë£Œëœ ì‹œìŠ¤í…œì´ ë°°í¬ëœ ì„œë²„ì˜ ì£¼ì†Œ
    -   Swaggerë‚˜ Postmanì„ í†µí•œ API í…ŒìŠ¤íŠ¸í• ë•Œ í•„ìš”í•œ ìƒì„¸ ë°©ë²•
    -   í•´ë‹¹ ê³¼ì œë¥¼ ì§„í–‰í•˜ë©´ì„œ íšŒê³  ë‚´ìš© ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…
-   Swaggerë‚˜ Postmanì„ ì´ìš©í•˜ì—¬ API í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„

<br/>

### [ê³¼ì œ ì•ˆë‚´]

ìŒì•… ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ì—ëŠ” 3ê°€ì§€ ìš”ì†Œ `ë®¤ì§€ì…˜` `ê³¡` `ì•¨ë²”` ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

ì•¨ë²” í˜ì´ì§€, ë®¤ì§€ì…˜ í˜ì´ì§€, ê³¡ í˜ì´ì§€ì— ì¸ì ‘ ì •ë³´ë“¤ (ex, ê³¡ì˜ ë®¤ì§€ì…˜, ê³¡ì˜ ì•¨ë²”) ì„ í‘œí˜„í•  ìˆ˜ ìˆë„ë¡ **CRUD** APIë¥¼ êµ¬ì„±í•´ì£¼ì„¸ìš”.

ì´ í˜ì´ì§€ë“¤ì— ëŒ€í•œ DBë¥¼ êµ¬ì„±í•  ë•Œ `ê³¡` - `ë®¤ì§€ì…˜` ì—°ê²°ê³¼ `ê³¡` - `ì•¨ë²”` ì—°ê²°ì€ ë‚´ë¶€ ìš´ì˜íŒ€ì—ì„œ ì§ì ‘ ì—°ê²° ê°€ëŠ¥í•˜ì§€ë§Œ, `ë®¤ì§€ì…˜` - `ì•¨ë²”` ì •ë³´ê¹Œì§€ íƒœê¹…í•˜ê¸°ì—” ë‚´ë¶€ ìš´ì˜ ë¦¬ì†ŒìŠ¤ê°€ ë¶€ì¡±í•œ ìƒí™©ìœ¼ë¡œ ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.

ì´ ë•Œ, `ë®¤ì§€ì…˜` - `ê³¡` ì´ ì—°ê²°ë˜ì–´ìˆê³  `ê³¡` - `ì•¨ë²”` ì´ ì—°ê²°ë˜ì–´ìˆë‹¤ë©´ `ë®¤ì§€ì…˜` - `[ê³¡*]` - `ì•¨ë²”` ì—°ê²°ë˜ì–´ìˆë‹¤ê³  íŒë‹¨í•  ìˆ˜ ìˆëŠ”ë°ìš”. ì´ íŠ¹ì„±ì„ ì´ìš©í•´ì„œ `ë®¤ì§€ì…˜` ì˜ `ì•¨ë²”` ì„ ë³´ì—¬ì£¼ëŠ” Read API, íŠ¹ì • `ì•¨ë²”` ì˜ ë®¤ì§€ì…˜ ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” Read APIë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

-   **Neo4j DB í…Œì´ë¸” ìš”êµ¬ì‚¬í•­**
    -   `ë®¤ì§€ì…˜`, `ê³¡`, `ì•¨ë²”`ì€ ê°ê°ì˜ í…Œì´ë¸” (musician, song, album)ë¡œ êµ¬ì„±ë˜ì–´ì•¼í•©ë‹ˆë‹¤.
    -   `ì•¨ë²”` ì•ˆì—ëŠ” ì—¬ëŸ¬ `ê³¡`ì´ ì†í•´ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    -   í•œ `ê³¡`ì—ëŠ” ì—¬ëŸ¬ `ë®¤ì§€ì…˜`ì´ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    -   í•œ `ê³¡`ì€ `ì•¨ë²”` 1ê°œì—ë§Œ ë“¤ì–´ê°€ìˆìŠµë‹ˆë‹¤.
    -   `ë®¤ì§€ì…˜`ì€ ì—¬ëŸ¬ ì•¨ë²”ì„ ê°–ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    -   `ë®¤ì§€ì…˜`, `ì•¨ë²”`, `ê³¡` ë°ì´í„°ëŠ” ìœ„ relationì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì„ë§Œí¼ ì„ì˜ë¡œ ìƒì„±í•´ì£¼ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.

<br/>

## ğŸ« ì‚¬ìš© ê¸°ìˆ 

-   Backend : <img src="https://img.shields.io/badge/NestJS-E0234E?style=flat&logo=NestJS&logoColor=white"/></a> <img src="https://img.shields.io/badge/TypeScript-3178C6?style=flat&logo=TypeScript&logoColor=white"/></a> <img src="https://img.shields.io/badge/GraphQL-E10098?style=flat&logo=GraphQL&logoColor=white"/></a>
-   DataBase : <img src="https://img.shields.io/badge/Neo4j-008CC1?style=flat&logo=Neo4j&logoColor=white"/></a>
-   Collaboration : <img src="https://img.shields.io/badge/Git-F05032?style=flat&logo=Git&logoColor=white"/></a> <img src="https://img.shields.io/badge/GitHub-181717?style=flat&logo=GitHub&logoColor=white"/></a> <img src="https://img.shields.io/badge/Postman-FF6C37?style=flat&logo=Postman&logoColor=white"/></a>
-   Deploy: <img src="https://img.shields.io/badge/Amazon AWS-232F3E?style=flat&logo=Amazon AWS&logoColor=white"/>

<br/>

## ğŸ“‚ í´ë” êµ¬ì¡°

5ê°œì˜ domainì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.

- album
- musician
- song
- relation 
- read

ê° domainì€ ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

- module
- controller
- service
- repository
- exception folder (for Custom Exception)

read í´ë”: GraphQL ê´€ë ¨ í´ë”

neo4j í´ë”: neo4j ì„¤ì • ë° ì—°ê²° ê´€ë ¨ í´ë”

```
.
â”œâ”€â”€ src
â”‚  â”œâ”€â”€ domain
â”‚  â”‚  â”œâ”€â”€ album
â”‚  â”‚  â”‚  â”œâ”€â”€ dto
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ create.dto.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ album.controller.spec.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ album.controller.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ album.module.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ album.repository.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ album.serivce.spec.ts
â”‚  â”‚  â”‚  â””â”€â”€ album.service.ts
â”‚  â”‚  â”œâ”€â”€ musician
â”‚  â”‚  â”‚  â””â”€â”€ ...
â”‚  â”‚  â”œâ”€â”€ relation
â”‚  â”‚  â”‚  â””â”€â”€ ...
â”‚  â”‚  â”œâ”€â”€ song
â”‚  â”‚  â”‚  â””â”€â”€ ...

â”‚  â”‚  â”œâ”€â”€ read
â”‚  â”‚  â”‚  â”œâ”€â”€ entity
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ album.entity.ts
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ musician.entity.ts
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ song.entity.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ graphql
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ album.graphql
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ graphql.schema.ts
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ musician.graphql
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ song.graphql
â”‚  â”‚  â”‚  â”œâ”€â”€ loader
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ haveSongDataLoader.loader.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ resolver
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ albumRead.resolver.ts
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ albumRead.resolver.spec.ts
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ musicianRead.resolver.ts
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ musicianRead.resolver.spec.ts
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ songRead.resolver.ts
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ songRead.resolver.spec.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ read.module.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ read.service.spec.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ read.service.ts
â”‚  â”œâ”€â”€ global
â”‚  â”‚  â””â”€â”€ common
â”‚  â”‚  â”‚  â”œâ”€â”€ commonResponse.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ errorCode.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ errorResponse.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ successCode.ts
â”‚  â”‚  â”‚  â””â”€â”€ successResponse.ts
â”‚  â”‚  â””â”€â”€ exception
â”‚  â”‚  â”‚  â””â”€â”€ errorHandler.ts
â”‚  â”œâ”€â”€ neo4j
â”‚  â”‚  â”œâ”€â”€ neo4j.constants.ts
â”‚  â”‚  â”œâ”€â”€ neo4j.module.ts
â”‚  â”‚  â”œâ”€â”€ neo4j.service.spec.ts
â”‚  â”‚  â”œâ”€â”€ neo4j.service.ts
â”‚  â”‚  â””â”€â”€ neo4j.util.ts
â”‚  â”œâ”€â”€ app.module.ts
â”‚  â”œâ”€â”€ main.ts
â”‚  â””â”€â”€ neo4j-config.interface.ts
â”œâ”€â”€ test
â”‚  â”œâ”€â”€ app.e2e-spec.ts
â”‚  â””â”€â”€ jest-e2e.json
â”œâ”€â”€ nest-cli.json
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.build.json
â””â”€â”€ README.md
```



<br/>

## ğŸ§¬ DB ëª¨ë¸ë§

![GraphDB](https://user-images.githubusercontent.com/60311404/140509284-2a97df44-2504-4100-91ae-515df047e9b0.png)

![image](https://user-images.githubusercontent.com/41619081/140576824-c7c5edce-ccb5-41fa-bb53-50bf1caa9657.png)


<br/>

## ğŸ”— êµ¬í˜„ ê¸°ëŠ¥

### 1) Check List


- **í™”ë©´ë³„ Read API ìš”êµ¬ì‚¬í•­ (GraphQL)**
   
 `ê³¡` í˜ì´ì§€

  âœ… í•´ë‹¹ `ê³¡`ì´ ì†í•œ `ì•¨ë²”`ì„ ê°€ì ¸ì˜¤ëŠ” API
    
  âœ… í•´ë‹¹ `ê³¡`ì„ ì“´ `ë®¤ì§€ì…˜` ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” API

 `ì•¨ë²”` í˜ì´ì§€

  âœ… í•´ë‹¹ `ì•¨ë²”`ì„ ì“´ `ë®¤ì§€ì…˜` ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” API

  âœ… í•´ë‹¹ `ì•¨ë²”`ì˜ `ê³¡` ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” API

 `ë®¤ì§€ì…˜` í˜ì´ì§€

  âœ… í•´ë‹¹ `ë®¤ì§€ì…˜`ì˜ ëª¨ë“  `ì•¨ë²”` API

  âœ… í•´ë‹¹ `ë®¤ì§€ì…˜`ì˜ `ê³¡` ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” API

- **Create, Update, Delete API ìš”êµ¬ì‚¬í•­ (RESTful API)**

  âœ… `ê³¡` ìƒì„± API

  âœ… `ì•¨ë²”` ìƒì„± API

  âœ… `ë®¤ì§€ì…˜` ìƒì„± API

  âœ… `ë®¤ì§€ì…˜` - `ê³¡` ì—°ê²°

  âœ… `ë®¤ì§€ì…˜` - `ê³¡` ì—°ê²°í•´ì œ API

  âœ… `ê³¡` - `ì•¨ë²”` ì—°ê²°

  âœ… `ê³¡` - `ì•¨ë²”`ì—°ê²°í•´ì œ API

  âœ… `ë®¤ì§€ì…˜` - `ì•¨ë²”` ì—°ê²°/ì—°ê²°í•´ì œ API ëŠ” í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (êµ¬í˜„ X)

  - `ë®¤ì§€ì…˜` - `ê³¡` ì—°ê²°ê³¼ `ê³¡` - `ì•¨ë²”` ì—°ê²°ì´ ë˜ì–´ìˆìœ¼ë©´
    GraphDB (neo4j) ì—ì„œ `ë®¤ì§€ì…˜` - [*] - `ì•¨ë²”` ì—°ê²° ì—¬ë¶€ë¥¼ ë½‘ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì´ íŠ¹ì„±ì„ Read APIì—ì„œ í™œìš©**í•´ì£¼ì„¸ìš”.


- **Test**

  âœ… E2E Test
  
  âœ… Unit Test - GraphQL
  
  ğŸ”º Unit Test - Domain

### 2) ìƒì„¸ ë‚´ìš©

#### Neo4j aruaDB ì´ìš©

ê°œë°œì‹œì— íŒ€ì›ë“¤ì´ ëª¨ë‘ ê°™ì€ DBë¥¼ ì´ìš©í•˜ê³ , ë°°í¬ì‹œì—ë„ í¸ë¦¬í•˜ë„ë¡ local DBMSê°€ ì•„ë‹Œ í´ë¼ìš°ë“œ í˜•íƒœì˜ Neo4j aruaDB ë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤. 

![Neo4j_ARUA](https://user-images.githubusercontent.com/43634786/140530811-9877e852-771d-49e0-a672-1f69ec28ba4e.png)

#### ê° Nodeì— Id ì†ì„± ì¶”ê°€

ì´ë¦„ì´ ê°™ì€ ë®¤ì§€ì…˜, ì´ë¦„ì´ ê°™ì€ ì•¨ë²” ë“±ì´ ì¡´ì¬í•  ê²ƒ ê°™ì•„ 

Node ìƒì„±ì‹œì— apoc.create.uuid() ë¡œ idê°’ì„ ìƒì„±í•´ì„œ ë„£ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ Nodeë¥¼ idë¡œ ì‹ë³„í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

#### GraphQL ê´€ë ¨ 


***1. schema first ë°©ì‹ ì‚¬ìš©***

graphqlì˜ `autoSchemaFile: true` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ graphql schema fileì„ ë§Œë“œëŠ” `code first ë°©ì‹`ì´ ì•„ë‹Œ, ì‚¬ìš©ìê°€ ì§ì ‘ ì‘ì„±í•˜ëŠ” `schema first ë°©ì‹`ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
`schema first ë°©ì‹`ì€ ì‚¬ìš©ìê°€ ì§ì ‘ graphql schema fileì„ ì‘ì„±í•´ì•¼ í•´ì„œ ë°˜ë“œì‹œ SDL(Schema Definition Language)ê³¼ Resolverê°€ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•˜ê³ , ì½”ë“œê°€ ì‹¤í–‰ë˜ì–´ì•¼ ì˜¤ë¥˜ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.     

í•˜ì§€ë§Œ graphql schemaë¥¼ ë¨¼ì € ì •ì˜í•˜ê³  í•´ë‹¹ ì •ì˜ì— ë§ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë°©ì‹ì´ë¼ ì½”ë“œê°€ ì „ë¶€ ì‘ì„±ëœ ì´í›„ graphql schema fileì´ ì •ì˜ë˜ëŠ” `code first ë°©ì‹`ì— ë¹„í•´ ê¸°ìˆ ì— ìµìˆ™í•˜ì§€ ì•Šì€ ì‚¬ëŒì´ ì´í•´í•˜ê¸° ì‰¬ìš°ë©° schema modelì„ ë§Œë“¤ë©´ì„œ íŒ€ì›ê°„ ì˜ì‚¬ì†Œí†µì˜ ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¼ì„ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.      

graphql ê¸°ìˆ ì„ ë‹¤ë¤„ë³¸ ì‚¬ëŒê³¼ ë‹¤ë¤„ë³´ì§€ ëª»í•œ ì‚¬ëŒì´ ì„ì—¬ì„œ í•œ íŒ€ì„ ì´ë£¬ ê²½ìš° ìµœê³ ì˜ ë°©ë²•ì´ë¼ê³  ìƒê°í•˜ì—¬ `schema firt ë°©ì‹`ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.    


<p align="center"><img src="https://user-images.githubusercontent.com/52685665/140557963-fa46aa62-b1b0-4739-bedd-ecd156e7aef1.png"></p>

<br/>
<br/>


***2. Data loader***

graphqlë„ Rest APIì²˜ëŸ¼ N + 1 ë¬¸ì œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. Musicianê³¼ ì—°ê´€ëœ Songì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ResolverFieldë¥¼ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.  


``` javascript
@ResolveField(() => [Song])
song(@Parent() musician: Musician) {
    return this.readService.readHaveSong(musician);
}
```
<br/>
<br/>

í•´ë‹¹ ResolverFieldì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ readHaveSong()ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, ë§Œì•½ 10ê°œì˜ musicianê³¼ ê´€ë ¨ëœ Songì„ ì°¾ëŠ”ë‹¤ê³  í•˜ë©´ 11ë²ˆì˜ ì¿¼ë¦¬ê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤.  

<br/>

``` javascript
async readHaveSong(musician) {
    const haveSong = await this.neo4jService
        .read(
            `MATCH (m:MUSICIAN)-[HAVE]->(s:SONG) WHERE m.id = '${musician["id"]}'  RETURN s`
        )
        .then((res) =>
            res.records.map((row) => new Song(row.get("s")).toJson())
        );

    return haveSong;
}
```

<br/>

graphql ì—ì„œëŠ” ì´ëŸ¬í•œ N + 1ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ data-loaderë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì—¬ëŸ¬ê°œì˜ musician idê°’ì„ ëª¨ì•„ì„œ IN queryë¥¼ ë°œìƒì‹œí‚´ìœ¼ë¡œì„œ ê¸°ì¡´ì˜ 11ë²ˆ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬ë¥¼ 1ë²ˆì˜ ì¿¼ë¦¬ë§Œì„ ì‚¬ìš©í•´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.   

<br/>

```javascript
@ResolveField(() => [Song])
song(
    @Parent() musician: Musician,
    @Loader(HaveSongDataLoader.name)
    locationGroupDataLoader: DataLoader<any, any>
) {
    console.log("hello");
    console.log(musician);
    return locationGroupDataLoader.load(musician);
}
```

```javascript
@Injectable()
export class HaveSongDataLoader {
	constructor(private readonly neo4jService: Neo4jService) {}
	generateDataLoader() {
		return new DataLoader<any, any>(async (musician_id) => {
			console.log(musician_id);
			const loader = await this.neo4jService
				.read(
					`MATCH (m:MUSICIAN)-[HAVE]->(s:SONG) WHERE m.id = [${musician_id}]  RETURN s`
				)
				.then((res) =>
					res.records.map((row) => new Song(row.get("s")).toJson())
				);
			loader.map((element) => console.log(element));
			return null;
		});
	}
}
```
<br/>
<br/>

ë‹¤ë§Œ ì•„ì‰½ê²Œë„ í˜„ì¬ `Nest Js v8`ê³¼ `nestjs-dataloader: 7.0.1` ê°€ ì œëŒ€ë¡œ í˜¸í™˜ë˜ì§€ ì•Šì•„ Rxjsê°€ ì¶©ëŒí•˜ë©° ë°œìƒí•˜ëŠ” ë²„ê·¸ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë²„ê·¸ê°€ ìˆì–´ì„œ ê²°êµ­ì—ëŠ” data loaderë¥¼ ì ìš©ì‹œí‚¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì˜¤ë¥˜ê°€ í•´ê²°ë˜ë©´ data loaderë¥¼ ì ìš©ì‹œí‚¬ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.   


```
Property 'intercept' in type 'DataLoaderInterceptor' is not assignable to the same property in base type 'NestInterceptor<any, any>'.    
  Type '(context: ExecutionContext, next: CallHandler<any>) => Observable<any>' is not assignable to type '(context: ExecutionContext, next: CallHandler<any>) => Observable<any> | Promise<Observable<any>>'.
    Type 'Observable<any>' is not assignable to type 'Observable<any> | Promise<Observable<any>>'.
      Type 'import("C:/Users/mm/Desktop/Study/sparta/99/Assignment_2_MAPIA/node_modules/neo4j-driver/node_modules/rxjs/internal/Observable").Observable<any>' is not assignable to type 'import("C:/Users/mm/Desktop/Study/sparta/99/Assignment_2_MAPIA/node_modules/rxjs/dist/types/internal/Observable").Observable<any>'.
        The types of 'operator.call' are incompatible between these types.
```


#### End to end test

ê° ë„ë©”ì¸ì— ë“¤ì–´ì˜¤ëŠ” Requestì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•´ ì»¨íŠ¸ë¡¤ëŸ¬ ìœ ë‹›í…ŒìŠ¤íŠ¸ë¥¼ í•´ì•¼í•˜ì§€ë§Œ
í˜„ì¬ NestJS í”„ë¡œì íŠ¸ì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì— ë“¤ì–´ì˜¤ê¸° ì „ì— pipeë¼ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ í†µí•´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ê¸°ë•Œë¬¸ì—
e2e í…ŒìŠ¤íŠ¸ë¡œ ê° ë„ë©”ì¸ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

[ìœ íš¨ì„± ê²€ì‚¬ëŠ” e2e í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ì„œ..](https://stackoverflow.com/questions/58843038/how-to-manually-test-input-validation-with-nestjs-and-class-validator)


<br/>

## ğŸ¾ API 

[Postman ì£¼ì†Œ-ë§í¬](https://documenter.getpostman.com/view/15410333/UVC2G8wv)

<br/>

## ğŸ¾ API Test ë°©ë²•

### 1. ìœ„ì˜ Postman ì£¼ì†Œ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ Postmanìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.
### 2. ì„œë²„ ì£¼ì†Œê°€ ì•Œë§ì€ì§€ í™•ì¸í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/41619081/140549043-f899abb8-5521-4111-b56c-4ecffc7b8e76.png)

<br/>

### 3. Create APIë¥¼ ì´ìš©í•˜ì—¬ ê°ê°ì˜ ê³¡, ì•¨ë²”, ë®¤ì§€ì…˜ì„ ìƒì„±í•˜ì—¬ idê°’ì„ ì–»ìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/41619081/140575288-06fbc578-3080-4d31-9d19-3e440ce314b9.png)

<br/>

### 4. ê°ê°ì˜ ì–»ì€ idê°’ì„ ì´ìš©í•˜ì—¬ ì•¨ë²”-ê³¡, ë®¤ì§€ì…˜-ê³¡ì„ ì—°ê²° ë˜ëŠ” ì—°ê²°í•´ì œ í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/41619081/140575463-2129757e-8a2d-4718-ab91-60732f9a8934.png)

<br/>

### 5. ê°ê°ì˜ ì–»ì€ idê°’ì„ ì´ìš©í•˜ì—¬ ê³¡, ì•¨ë²”, ë®¤ì§€ì…˜ì— ëŒ€í•œ ì›í•˜ëŠ” ì •ë³´ë¥¼ í•˜ë‚˜ ë˜ëŠ” ì „ë¶€ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![image](https://user-images.githubusercontent.com/41619081/140576239-24d15fa3-22f1-4761-b220-433d39db6225.png)
![image](https://user-images.githubusercontent.com/41619081/140576097-95535ed8-d982-425d-8b53-5f5471d1d238.png)

<br/>

### 6. ê°ê°ì˜ ì–»ì€ idê°’ì„ ì´ìš©í•˜ì—¬ ê³¡, ì•¨ë²”, ë®¤ì§€ì…˜/ ì•¨ë²”-ê³¡, ë®¤ì§€ì…˜-ê³¡ ì—°ê²°ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/41619081/140575725-c5692915-8047-4174-be6e-bb080970e0cd.png)

### 7. ê°ê°ì˜ ì–»ì€ idê°’ì„ ì´ìš©í•˜ì—¬ ê³¡, ì•¨ë²”, ë®¤ì§€ì…˜ì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/41619081/140576422-3db6d354-4b58-4c2c-8e34-7d7da28a08d6.png)



<br/>


## ğŸ­ TIL ë¸”ë¡œê·¸ ì£¼ì†Œ

- ê¹€ë°”ë‹¤ : 
- ê¹€íš¨ë¯¼ : [í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸](https://baejjang.tistory.com/5)
- ì›ë™ê·  : [í‹°ìŠ¤í† ë¦¬ ë¸”ë¡œê·¸](https://tristy.tistory.com/44)
- ì´ë‚˜ì˜ :
- ì¥í¬ì§„ : 
- ì¡°ì¬ë³µ : 

<br/>
